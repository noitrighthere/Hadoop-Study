## 맵리듀스 구성

맵리듀스 프레임워크는 개발자가 분석 로직을 구현하는 데 집중하게 해주고, 데이터에 대한 분산과 병렬 처리를 프레임워크가 전담한다. 아케텍처를 이해하면 정렬이나 병합 등 다양한 분석 코드를 구현할 수 있게 되고, 맵리듀스 환경설정 파일을 튜닝할 때 도움을 받을 수 있다.

### 시스템 구성

맵리듀스 시스템은 `클라이언트`, `잡트래커`, `태스크트래커`로 구성된다.

하둡에서 잡은 1:n 방식으로 실행되는데, 1은 잡트래커라고 할 수 있고 n은 태스크트래커라고 할 수 있다. 잡트래커는 테스크트래커가 수행할 때 각각 태스크를 스케줄링해 시스템 내에서 수행하는 모든 잡이 실행되도록 조절하는 역할을 수행한다. 태스크트래커는 각각의 태스크를 수행한 후, 각각의 실행 결과를 잡트래커에 보내는 역할을 한다.

![맵리듀스 시스템 구성](/img/맵리듀스/맵리듀스_시스템_구성.png "맵리듀스 시스템 구성")

#### 클라이언트

클라이언트는 사용자가 실행한 맵리듀스 프로그램과 하둡에서 제공하는 맵리듀스 API를 의미한다. 맵리듀스 API로 맵리듀스 프로그램을 개발하고, 개발한 프로그램을 하둡에서 실행할 수 있다.

#### 잡트래커

클라이언트가 하둡으로 **실행을 요청하는 프로그램**은 `잡(job)`이라는 하나의 작업 단위로 관리된다. 잡트래커(JobTracker)는 하둡 클러스터에 등록된 전체 잡의 **스케줄링을 관리하고 모니터링한다.** 전체 하둡 클러스터에서 하나의 잡트래커가 실행되며, 보통 하둡의 네임노드 서버에서 실행된다.

사용자가 새로운 잡을 요청하면 잡트래커는 잡을 처리하기 위해 몇 개의 맵과 리듀스를 실행할지 계산한다. 계산된 맵과 리듀스를 어떤 태스크트래커에서 실행할지 결정하고, 해당 테스크트래커에 잡을 할당한다. 이때 태스크트래커는 잡 트래커의 작업 수행 요청을 받아 맵리듀스 프로그램을 실행한다. 잡트래커와 태스크트래커는 하트비트라는 메소드로 네트워크 통신을 하면서 스크트래커의 상태와 작업 실행 정보를 주고 받게 된다. 만약 태스크트래커에 장애가 발생하면 잡트래커는 다른 대기 중인 태스크트래커를 찾아 태스크를 재실행하게 된다.

#### 태크스트래커

태스크트래커는 사용자가 설정한 **맵리듀스 프로그램을 실행하며, 하둡의 데이터노드에서 실행되는 데몬**이다. 태스크트래커는 잡트래커의 작업을 요청받고, 잡트래커가 요청한 맵리듀스 개수만큼 맵 태스크(map task)와 리듀스 태스크(reudce task)를 생성한다. *(맵 태스크와 리듀스 태스크는 사용자가 설정한 맵과 리듀스 프로그램을 의미한다.)* 맵 태스크와 리듀스 태스크가 생성되면 새로운 JVM(Java Virtual Machine)을 구동해 맵 태스크와 리듀스 태스크를 실행한다.