# 맵리듀스

하둡은 HDFS와 맵리듀스로 구성된다. 맵리듀스는 HDFS에 **저장된 파일을 분산 배치 분석을 할 수 있게 도와주는 프레임워크**이다. 

## 맵리듀스 개념

맵리듀스 프로그래밍 모델은 `맵(Map)`과 `리듀스(Reduce)`라는 두 가지 단계로 데이터를 처리한다. 맵은 입력 파일을 한 줄씩 읽어서 **데이터를 변형**하며, 리듀스는 맵의 **결과 데이터를 집계**한다.

맵리듀스 프로그래밍 모델로 처리되는 과정은 다음과 같다.

1. 혼재된 각종 데이터 세트를 각각 **Key**와 **Value** 쌍으로 묶어서 Map 함수의 입력 값으로 보내는 단계다. 전송된 데이터 세트를 Map을 통해 필요한 분석 대상만을 각각 추출한 후 필요 없거나 잘못된 레코드를 제거하는 작업을 한다.

2. 1단계 작업이 완료되면, 분석 대상 값만을 추출한다. 추출된 분석 대상 데이터를 Key-Value 형태로 정렬해 Reduce에게 보낸다. 전송된 데이터는 Reduce 함수를 입력 값으로 사용된다.

3. Reduce 함수로 2단계에서 받은 입력값을 분석해 원하는 값을 구하는 단계다. Map은 산재된 입력 데이터를 원하는 형태의 데이터와 묶어주는 작업을 통해 Repository 데이터 형태를 띄게 된다. 이 단계에서는 리듀스를 통해 *(중복된 값을 제거해)* 원하는 데이터를 추출하는 작업을 진행한다.

![맵리듀스 프로그래밍 모델의 처리 과정](/img/맵리듀스/맵리듀스_프로그래밍_모델의_처리_과정.png "맵리듀스 프로그래밍 모델의 처리 과정")

위 그림의 맵은 한 줄에 있는 단어 개수를 계산해 한 줄씩 출력한다. 이때 각 단어는 한 줄에 하나씩밖에 없기 때문에 단어 개수로 1씩 출력된다. 예를 들면, read a book의 경우, *read, a, book* 이라는 세 단어로만 구성되어 있으므로 단어의 개수로 1씩 출력된 것이다.

리듀스는 맵의 출력 데이터를 집계한다. 맵의 출력 데이터에는 단어의 개수로 1씩만 출력되어 있었지만 리듀스의 출력 파일에서는 a는 2, book은 2가 출력된 것이다.

이러한 맵리듀슬 프로그래밍 모델은 일반적으로 다음과 같은 함수로 표현된다.

>맵(데이터 저장): (k1, v1) -> list(k2, v2)   
리듀스(데이터 처리): (k2, list(v2)) -> (k3, list(v3))

맵은 키(k1)와 값(v1)으로 구성된 데이터를 입력받아 이를 가공하고 분류한 후, 새로운 키(k2)와 값(v2)로 구성된 목록을 출력한다. 이때 맵 메소드가 반복해서 수행되다 보면 새로운 키(k2)를 가진 여러 개의 데이터가 만들어진다. 그림의 경우, 맵의 입력키는 각 줄 번호, 입력값은 각 줄을 의미한다 그리고 맵의 출력키는 단어, 출력값은 단어의 개수를 의미한다.

리듀스는 새로운 키(k2)를 그룹핑된 값의 목록(list(v2))을 입력 데이터로 전달받는다. 그리고 값의 목록(list(v2))에 대한 집계 연산을 실행해 새로운 키(k3)로 그룹핑된 새로운 값(v3)의 목록을 생성한다. 그림의 경우, 리듀스의 입력 키는 단어이고, 입력된 값은 단어 개수의 목록이며, 출력 키는 단어, 출력값은 단어 개수의 합계를 의미한다.

하둡의 맵리듀스 프레임워크는 이러한 프로그래밍 모델을 구현할 수 있게 맵과 리듀스 인터페이스를 제공한다.